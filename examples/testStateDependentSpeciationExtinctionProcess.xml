<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<beast namespace="beast.core:beast.evolution.alignment:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood" required="BEAST v2.5.0" version="2.5">





<run id="mcmc" spec="MCMC" chainLength="10000000">
    <state id="state" storeEvery="5000">
        <stateNode idref="SympatricRate"/>
        <stateNode idref="SubsympatricRate"/>
        <stateNode idref="VicariantRate"/>
        <stateNode idref="JumpRate"/>
        <!-- TODO: add Mu and Q -->
    </state>


    <distribution id="posterior" spec="util.CompoundDistribution">
        <distribution id="prior" spec="util.CompoundDistribution">
            <distribution id="SympatricRatePrior" spec="beast.math.distributions.Prior" x="@SympatricRate">
	  	     	 <!-- TODO: specify sensible priors -->
                <distr id="Uniform.1" spec="beast.math.distributions.Uniform" upper="Infinity"/>
            </distribution>
            <distribution id="SubsympatricRatePrior" spec="beast.math.distributions.Prior" x="@SubsympatricRate">
                <distr id="Uniform.2" spec="beast.math.distributions.Uniform" upper="Infinity"/>
            </distribution>
            <distribution id="VicariantRatePrior" spec="beast.math.distributions.Prior" x="@VicariantRate">
                <distr id="Uniform.3" spec="beast.math.distributions.Uniform" upper="Infinity"/>
            </distribution>
            <distribution id="JumpRatePrior" spec="beast.math.distributions.Prior" x="@JumpRate">
                <distr id="Uniform.4" spec="beast.math.distributions.Uniform" upper="Infinity"/>
            </distribution>
	        <!-- TODO: add priors for Mu and Q -->
        </distribution>
        <distribution id="likelihood" spec="util.CompoundDistribution" useThreads="true">


			<distribution id="StateDependentSpeciationExtinctionProcess" spec="biogeo.StateDependentSpeciationExtinctionProcess" IncorporateCladogenesis="true">
			    <TreeParser id="TreeParser" spec="beast.util.TreeParser" IsLabelledNewick="true" adjustTipHeights="false" newick="(((Human:1.0,Chimp:1.0):1.0,Gorilla:2.0):1.0,Orang:3.0);" offset="0" singlechild="false">
			        <taxonset id="TaxonSet" spec="TaxonSet">
			            <taxon id="Human" spec="Taxon"/>
			            <taxon id="Chimp" spec="Taxon"/>
			            <taxon id="Gorilla" spec="Taxon"/>
			            <taxon id="Orang" spec="Taxon"/>
			        </taxonset>
			    </TreeParser>
			
			    <TraitStash id="TraitStash" spec="biogeo.TraitStash" value="Human=2,Chimp=2,Gorilla=2,Orang=3">
			        <taxa idref="TaxonSet"/>
			    </TraitStash>

			    <InstantaneousRateMatrix id="InstantaneousRateMatrix" spec="biogeo.InstantaneousRateMatrix" NumberOfStates="4">
			        <parameter id="FlatQMatrix" dimension="16" lower="0.0" minordimension="4" name="FlatQMatrix" upper="0.0">0.0 0.0 0.0 0.0 0.01 0.0 0.0 0.01 0.01 0.0 0.0 0.01 0.0 0.01 0.01 0.0</parameter>
			    </InstantaneousRateMatrix>
			
			    <CladogeneticStash id="CladogeneticSpeciationRateStash" spec="biogeo.CladogeneticSpeciationRateStash">
			        <CladoTriplets id="CladoTriplet" spec="biogeo.CladoTriplet" LeftChildState="1" ParentState="1" RightChildState="1" SpeciationType="SYMPATRY"/>
			        <CladoTriplets id="CladoTriplet1" spec="biogeo.CladoTriplet" LeftChildState="2" ParentState="2" RightChildState="2" SpeciationType="SYMPATRY"/>
			        <CladoTriplets id="CladoTriplet2" spec="biogeo.CladoTriplet" LeftChildState="3" ParentState="3" RightChildState="3" SpeciationType="SYMPATRY"/>
			        <CladoTriplets id="CladoTriplet3" spec="biogeo.CladoTriplet" LeftChildState="2" ParentState="2" RightChildState="3" SpeciationType="JUMPDISPERSAL"/>
			        <CladoTriplets id="CladoTriplet4" spec="biogeo.CladoTriplet" LeftChildState="2" ParentState="3" RightChildState="3" SpeciationType="JUMPDISPERSAL"/>
			        <CladoTriplets id="CladoTriplet5" spec="biogeo.CladoTriplet" LeftChildState="2" ParentState="4" RightChildState="3" SpeciationType="VICARIANCE"/>
			        <CladoTriplets id="CladoTriplet6" spec="biogeo.CladoTriplet" LeftChildState="2" ParentState="4" RightChildState="4" SpeciationType="SUBSYMPATRY"/>
			        <CladoTriplets id="CladoTriplet7" spec="biogeo.CladoTriplet" LeftChildState="3" ParentState="4" RightChildState="4" SpeciationType="SUBSYMPATRY"/>
			        <SympatricRate id="SympatricRate" spec="parameter.RealParameter">0.32222224</SympatricRate>
			        <SubsympatricRate id="SubsympatricRate" spec="parameter.RealParameter">0.05370370666666666</SubsympatricRate>
			        <VicariantRate id="VicariantRate" spec="parameter.RealParameter">0.05370370666666666</VicariantRate>
			        <JumpRate id="JumpRate" spec="parameter.RealParameter">0.0</JumpRate>
			    </CladogeneticStash>
			
			    <Mu id="Mu" dimension="4" spec="parameter.RealParameter">0.1 0.1 0.1 0.1</Mu>
			
			    <Pi id="RealParameter6" dimension="8" spec="parameter.RealParameter">0.0 0.0 0.0 0.0 0.25 0.25 0.25 0.25</Pi>
			
			</distribution>
			
        </distribution>
    </distribution>

    <operator id="SympatricRateScaler" spec="ScaleOperator" parameter="@SympatricRate" scaleFactor="0.75" weight="3.0"/>
    <operator id="SubsympatricRateScaler" spec="ScaleOperator" parameter="@SubsympatricRate" scaleFactor="0.75" weight="3.0"/>
    <operator id="VicariantRateScaler" spec="ScaleOperator" parameter="@VicariantRate" scaleFactor="0.75" weight="3.0"/>
    <operator id="JumpRateScaler" spec="ScaleOperator" parameter="@JumpRate" scaleFactor="0.75" weight="3.0"/>

    <!-- TODO: add operators for Mu and Q -->

    <logger id="tracelog" fileName="StateDependentSpeciationExtinctionProcess.log" logEvery="1000" model="@posterior" sanitiseHeaders="true" sort="smart">
        <log idref="posterior"/>
        <log idref="likelihood"/>
        <log idref="prior"/>
        <log idref="SympatricRate"/>
        <log idref="SubsympatricRate"/>
        <log idref="VicariantRate"/>
        <log idref="JumpRate"/>
	    <!-- TODO: add loggers for Mu and Q -->
    </logger>

    <logger id="screenlog" logEvery="1000">
        <log idref="posterior"/>
        <log id="ESS.0" spec="util.ESS" arg="@posterior"/>
        <log idref="likelihood"/>
        <log idref="prior"/>
    </logger>

    <logger id="treelog.t:firsthalf" fileName="StateDependentSpeciationExtinctionProcess.trees" logEvery="1000" mode="tree">
        <log id="TreeWithMetaDataLogger" spec="beast.evolution.tree.TreeWithMetaDataLogger" tree="@TreeParser"/>
	    <!-- TODO: add logging for internal states on the tree-->
    </logger>

</run>
</beast>