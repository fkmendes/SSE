## author: Fabio K. Mendes
##
## This R script gives us expected values for the JUnit tests
## inside PropagatesQuaSSETest.java
##
## (1) testPropagateTimeOneChQuaSSETest
## (2) testMakeNormalKernInPlaceAndFFT
## (3) testConvolve
## (4) testPropagateChOneCh32QuaSSETest
## (5) testPropagateChOneCh1024QuaSSETest
## (6) testPropagateChOneCh4096QuaSSETest
## (7) testPropagateChOneCh4096QuaSSETestModalFftService
## (8) testPropagateChOneCh4096QuaSSETestJavaFftService

library(diversitree)

## First, diversitree's functions
source("rev_eng_diversitree.R")

## Test expectations
##
## (1) testPropagateTimeOneChQuaSSETest

vars <- cbind(rep(0.0001,32),
              c(8.50976807665641, 10.103792974434, 9.08976088347418, 11.847721337896, 8.51254745547751, 9.91650581983555, 8.95019918832521, 9.30609468137578, 11.0775496365384, 10.7639029400606, 10.9164931483932, 9.83064984974005, 11.7045125626528, 11.3382431919839, 8.94185500956388, 7.30298759647754, 11.1167065386435, 9.76891399488789, 9.76676261926709, 9.10540040702707, 8.93655752085786, 10.2580116547857, 10.2552822093573, 8.85921172559191, 11.0314684537514, 10.8738197102994, 10.4638936963999, 9.68617874031991, 8.35885856359494, 10.8426829704597, 7.66894489549493, 8.23694434625264))
# vars <- data.frame(0.0, 1.0) # E and D
lambda <- 1.0
mu <- 0.5
dt <- 0.01
ndat <- 28 # just one useful quant ch bin

#### eAndD

res <- fftR.propagate.t.debug(vars, lambda, mu, dt, ndat)

exp.es <- rep(0, length(res[,1])*2)
exp.ds <- rep(0, length(res[,2])*2)
idxs <- seq(1, length(res[,2])*2, by=2)
j <- 1
for (i in res[,2]) {
    exp.ds[idxs[j]] = i
    exp.es[idxs[j]] = res[1,1]
    j = j+1
}

print(paste(exp.es[1:20], collapse=", "))
## expectedEs = 0.00506128508712536, 0, 0.00506128508712536, 0, 0.00506128508712536, 0, 0.00506128508712536, 0, 0.00506128508712536, 0, 0.00506128508712536, 0, 0.00506128508712536, 0, 0.00506128508712536, 0, 0.00506128508712536, 0, 0.00506128508712536, 0

print(paste(exp.ds[1:20], collapse=", "))
## expectedDs = 8.38350785732404, 0, 9.95388205964182, 0, 8.95489525699789, 0, 11.6719355960008, 0, 8.38624599824343, 0, 9.7693737019512, 0, 8.8174042516822, 0, 9.16801929024715, 0, 10.913191003709, 0, 10.604197912398, 0

## (if using JTransforms)
## print(paste(res[1:10,1], collapse=", "))
## expectedEs = 0.00506128508712536, 0.00506128508712536, 0.00506128508712536, 0.00506128508712536, 0.00506128508712536, 0.00506128508712536, 0.00506128508712536, 0.00506128508712536, 0.00506128508712536, 0.00506128508712536

## print(paste(res[1:10,2], collapse=", "))
## expectedDs = 8.38350785732404, 9.95388205964182, 8.95489525699789, 11.6719355960008, 8.38624599824343, 9.7693737019512, 8.8174042516822, 9.16801929024715, 10.913191003709, 10.604197912398



## (2) testMakeNormalKernInPlaceAndFFT
##
## The normal kernel (fy) gives the probability of a change in quantitative
## trait values; here, each x bin is the CHANGE in quantitative trait values
## (not the quantitative trait values themselves!)
##
## Under BM, for example, this kernel is centered at 0.0
##
## This kernel (yValues) is later FFT-ed in the likelihood class, and then used
## in the convolution function, and for reasons I do not fully understand,
## this bell-shaped kernel needs to be cuts in two, with the left half being
## placed at the (right-)tail end of the kernel, and the right half at the
## (left-)head of the kernel

drift <- 0.0
diffusion <- 0.001
nkl <- nkr <- 2
nx <- 32

# changed from 0.001 -> 0.01, updating!
dx <- 0.01 # (dx * nx) gives the range of x values we're considering
dt <- 0.01

# '-' in -dt because we're going back in time
kern <- fftR.make.kern.debug(-dt * drift, sqrt(dt * diffusion), nx, dx, nkl, nkr)

paste(kern, collapse=", ")
## expectedFy = 0.986703287028858, 0.00664835445182386, 2.03374705433156e-09, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.03374705433156e-09, 0.00664835445182386

## plot(kern)

## x: the substitution rate
## y: gives you the probability of changing from x to (x + delta.x) over time dt,
## with delta.x being (dx * nkr) on the right-hand side of x, and (dx * nkl) on
## the left-hand side of x
##
## (later, y will be fourier-transformed into fy)

## worked example
##
## min x = 0.0
## max x = 0.1 = 1/10
## start x at rate = 0.01 = 1/100
## dx = 0.001
## nx = 100
## nkl = nkr = 4
##
## x is at 10th bin, so we ignore anything beyond nkl and nkr bins away from 10th, meaning
## x will influence from 5th - 15th bins
##
## the first bin gives the probability that x stays where it is
## the 2nd - 6th bin give the probability x changes to 11th - 15th bins
## the 95th - 100th bins give the probability x changes to the 9th - 5th

fy <- fft(kern)

## We don't immediately ifft fy in the likelihood calculation, this is being
## done here for testing purposes
ify <- ifft(fy)

paste(Re(fy)[1:10], collapse=", ") # expectedFftFY = 1, 0.999744507157237, 0.998987847110852, 0.997759097982437, 0.996105480062091, 0.994090541136289, 0.991791714355113, 0.989297342492751, 0.986703282961364, 0.984109224049216

paste(Re(ify)[1:10], collapse=", ") # expectedIfftFY = 31.5745051849235, 0.212747342458364, 6.50799056989047e-08, 1.52655665885959e-16, -4.44089209850063e-16, -2.35784152995104e-16, -4.15496150260171e-16, -2.91433543964104e-16, -8.88178419700125e-16, 8.15320033709099e-17



## (3) testConvolve (builds on [2] as it depends on fy, nx, nkl, nkr)

## see vars.fft.just.x below to see where this came from
vars <- cbind(rep(0.0, 32), c(0.0058389385158292, 0.0122380386022755, 0.0246443833694604, 0.0476817640292969, 0.0886369682387602, 0.158309031659599, 0.271659384673712, 0.447890605896858, 0.709491856924629, 1.07981933026376, 1.57900316601788, 2.21841669358911, 2.9945493127149, 3.88372109966426, 4.83941449038287, 5.79383105522965, 6.66449205783599, 7.36540280606647, 7.82085387950912, 7.97884560802865, 7.82085387950912, 7.36540280606647, 6.66449205783599, 5.79383105522965, 4.83941449038287, 3.88372109966426, 2.9945493127149, 2.21841669358911, 0, 0, 0, 0))


## convolve
paste(Re(apply(apply(vars, 2, fft) * fy, 2, ifft))[,2], collapse=", ")
## expectedDsUnnormalized = 0.186965206235882, 0.392895262124355, 0.790881995397243, 1.52962842317328, 2.84249242686772, 5.0751814647876, 8.70647806374478, 14.3506616579459, 22.726870664534, 34.581632450077, 50.5579348423759, 71.0184208525211, 95.849626817365, 124.293227499606, 154.860992049653, 185.384774972034, 213.227631891732, 235.64066883828, 250.204040383914, 255.255834736325, 250.204040383914, 235.64066883828, 213.227631891732, 185.384774972034, 154.860992049653, 124.293227499606, 95.8496267146036, 70.6824920549429, 0.471962450911363, 1.44374375565803e-07, 3.80026676793932e-10, 0.00124221944851399

## same as above, but normalizing Es and Ds by the number of bins
vars.out <- Re(apply(apply(vars, 2, fft) * fy, 2, ifft)) / nx
paste(vars.out[,1], collapse=", ") # expectedEs = 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
paste(vars.out[,2], collapse=", ")
## expectedDs = 0.00584266269487133, 0.0122779769413861,
##
## 0.0247150623561638, 0.047800888224165, 0.0888278883396163, 0.158599420774613, 0.272077439492024, 0.448458176810811, 0.710214708266688, 1.0806760140649, 1.57993546382425, 2.21932565164129, 2.99530083804266, 3.8841633593627, 4.83940600155166, 5.79327421787606, 6.66336349661661, 7.36377090119626, 7.81887626199732, 7.97674483551017, 7.81887626199732, 7.36377090119626, 6.66336349661661, 5.79327421787606,
##
## (continuation of expectedDs)
## 4.83940600155166, 3.88416335936269, 2.99530083483136, 2.20882787671697, 0.0147488265909801, 4.51169923643135e-09, 1.18758336498104e-11, 3.88193577660623e-05



## (4) testPropagateChOneCh32QuaSSETest (builds on [2] and [3] as it depends on fy, nx, nkl, nkr)
##
## This test differs from (3) in that fftR.propagate.x.debug will manage flanking bins
## (ignoring the leftmost and rightmost 2 bins), as it should be done during likelihood
## calculation. Note how the middle bins match (3), though.
##
## nx = 32
## nkl and nkr = 2
res <- fftR.propagate.x.debug(vars, nx, fy, nkl, nkr)

## expectedEs
paste(res[,1], collapse=", ") # 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0

paste(res[,2], collapse=", ")
## expectedDs = 0.0058389385158292, 0.0122380386022755,
##
## 0.0247150623561638, 0.047800888224165, 0.0888278883396163, 0.158599420774613, 0.272077439492024, 0.448458176810811, 0.710214708266688, 1.0806760140649, 1.57993546382425, 2.21932565164129, 2.99530083804266, 3.8841633593627, 4.83940600155166, 5.79327421787606, 6.66336349661661, 7.36377090119626, 7.81887626199732, 7.97674483551017, 7.81887626199732, 7.36377090119626, 6.66336349661661, 5.79327421787606,
##
## (continuation of expectedDs)
## 4.83940600155166, 3.88372109966426, 2.9945493127149, 0, 0, 0, 0, 0



## (5) testPropagateChOneCh1024QuaSSETest (does not depend on previous tests, we restart parameters)
##
## This test differs from (3) in that fftR.propagate.x.debug will manage flanking bins
## (ignoring the leftmost and rightmost 2 bins), as it should be done during likelihood
## calculation. Note how the middle bins match (3), though.

nx.1024 <- 1024
dx <- 0.0005

control.fft.just.x.1024 <- list(tc=100.0, # time point at which we go from high -> low resolution of X
                    dt.max=0.01, # dt
                    nx=nx.1024, # number of X bins
                    dx=dx, # size of each X bin
                    r=4L, # high res of X = nx * r
                    xmid=0, # sp rate ~ X is a logistic regression, and xmid is the value of X at the inflection point
                    w=10, # used to determine nkl and nkr (see quasse.extent)
                    flags=0L, # FFT stuff below
                    verbose=0L,
                    atol=1e-6,
                    rtol=1e-6,
                    eps=1e-3,
                    method="fftC")

sd <- 0.05
drift <- 0.0
diffusion <- 0.001
lambda <- sigmoid.x
mu <- constant.x

args.fft.just.x.1024 <- list(lambda=1:4, mu=5, drift=6, diffusion=7) # index of each parameter in args
pars.just.x.1024 <- c(.1, .2, 0, 2.5, .03, drift, diffusion) # specifies parameter values
# note that y0=0.1, y1=0.2, xmid=0.0, and r=2.5 for the sigmoid function for lambda

ext.fft.just.x.1024 <- quasse.extent.debug(control.fft.just.x.1024, drift, diffusion) # prepares X axis stuff
# ext.fft.just.x.1024$padding

pars.fft.just.x.1024 <- diversitree:::expand.pars.quasse(lambda, mu, args.fft.just.x.1024, ext.fft.just.x.1024, pars.just.x.1024) # adds lambda and mu vectors to ext.fft.just.x

nkl.1024 <- pars.fft.just.x.1024$lo$padding[1] # 64
nkr.1024 <- pars.fft.just.x.1024$lo$padding[2] # 64

## initialization
vars.fft.just.x.1024 <- matrix(0, control.fft.just.x.1024$nx, 2) # low resolution

## populating states in all bins, at tips, being drawn from a normal distribution centered at a species' observed value
## which here is assumed to be 0.0
##
## also note that the number of left and right flanking bins is 64
##
## pars.fft.just.x.1024$lo$padding
## nkl nkr
##  64  64
##
## and if you look at the last (64 + 64) rows
## in vars.fft.just.x.1024, should be 0.0
vars.fft.just.x.1024[seq_len(ext.fft.just.x.1024$ndat[2]),2] <- dnorm(ext.fft.just.x.1024$x[[2]], 0.0, sd) # getting the bins we care about (dropping last 64 + 64)
vars.1024 <- vars.fft.just.x.1024[seq_len(ext.fft.just.x.1024$ndat[2]),]

print(paste(vars.1024[1:48,2], collapse=", "))
## initialValues = 0.000365714984190948, 0.000382414193856355, 0.000399835934138456, 0.00041800955800901, 0.000436965523466329, 0.000456735431302938, 0.000477352064003592, 0.000498849425801072, 0.000521262783917567, 0.000544628711019852, 0.000568985128916886, 0.000594371353528846, 0.000620828141157005, 0.000648397736084276, 0.000677123919536558, 0.000707052060035464, 0.000738229165173324, 0.000770703934841743, 0.000804526815945299, 0.000839750058632349, 0.000876427774075162, 0.000914615993832026, 0.000954372730824099, 0.000995758041960245, 0.0010388340924432, 0.0010836652217908, 0.00113031801160615, 0.0011788613551308, 0.00122936652861539, 0.00128190726454212, 0.00133655982673381, 0.00139340308738429, 0.00145251860604505, 0.00151399071060322, 0.00157790658028586, 0.00164435633072572, 0.00171343310112364, 0.00178523314354266, 0.00185985591436892, 0.00193740416797439, 0.00201798405261629, 0.00210170520860801, 0.00218868086879601, 0.00227902796137729, 0.00237286721509132, 0.00247032326682047, 0.00257152477163242, 0.00267660451529771

## making kernel and FFTing
kern.1024 <- fftR.make.kern.debug(-dt * drift, sqrt(dt * diffusion), nx.1024, dx, nkl.1024, nkr.1024)
fy.1024 <- fft(kern.1024)

vars.1024.nkl.plus.nkr.zeros <- rbind(vars.1024, matrix(0, ncol=2, nrow=(nx.1024 - nrow(vars.1024)))) # must be matrix
res.1024 <- fftR.propagate.x.debug(vars.1024.nkl.plus.nkr.zeros, nx.1024, fy.1024, nkl.1024, nkr.1024)

print(paste(res.1024[1:48,2], collapse=", "))
## expectedDsFirst48 = 0.000365714984190948, 0.000382414193856355, 0.000399835934138456, 0.00041800955800901, 0.000436965523466329, 0.000456735431302938, 0.000477352064003592, 0.000498849425801072, 0.000521262783917567, 0.000544628711019852, 0.000568985128916886, 0.000594371353528846, 0.000620828141157005, 0.000648397736084276, 0.000677123919536558, 0.000707052060035464, 0.000738229165173324, 0.000770703934841743, 0.000804526815945299, 0.000839750058632349, 0.000876427774075162, 0.000914615993832026, 0.000954372730824099, 0.000995758041960245, 0.0010388340924432, 0.0010836652217908, 0.00113031801160615, 0.0011788613551308, 0.00122936652861539, 0.00128190726454212, 0.00133655982673381, 0.00139340308738429, 0.00145251860604505, 0.00151399071060322, 0.00157790658028586, 0.00164435633072572, 0.00171343310112364, 0.00178523314354266, 0.00185985591436892, 0.00193740416797439, 0.00201798405261629, 0.00210170520860801, 0.00218868086879601, 0.00227902796137729, 0.00237286721509132, 0.00247032326682047, 0.00257152477163242, 0.00267660451529771

print(paste(res.1024[848:895,2], collapse=", "))
## expectedDsLast48 = 0.00267660451529771, 0.00257152477163242, 0.00247032326682047, 0.00237286721509132, 0.0022790279613773, 0.00218868086879601, 0.00210170520860801, 0.0020179840526163, 0.00193740416797439, 0.00185985591436892, 0.00178523314354266, 0.00171343310112364, 0.00164435633072573, 0.00157790658028586, 0.00151399071060322, 0.00145251860604505, 0.00139340308738429, 0.00133655982673381, 0.00128190726454212, 0.00122936652861539, 0.0011788613551308, 0.00113031801160615, 0.0010836652217908, 0.0010388340924432, 0.000995758041960245, 0.000954372730824099, 0.000914615993832026, 0.000876427774075162, 0.000839750058632349, 0.000804526815945299, 0.000770703934841743, 0.000738229165173324, 0.000707052060035464, 0.000677123919536558, 0.000648397736084276, 0.000620828141157005, 0.000594371353528846, 0.000568985128916886, 0.000544628711019852, 0.000521262783917567, 0.000498849425801072, 0.000477352064003592, 0.000456735431302938, 0.000436965523466329, 0.00041800955800901, 0.000399835934138456, 0.000382414193856355, 0.000365714984190948



## (6) testPropagateChOneCh4096QuaSSETest
## (7) testPropagateChOneCh4096QuaSSETestModalFftService
## (8) testPropagateChOneCh4096QuaSSETestJavaFftService
##
## (builds on [5] and [3] as it depends on control.fft.just.x.1024, dt, dx, diffusion)
##
## This test differs from (3) in that fftR.propagate.x.debug will manage flanking bins
## (ignoring the leftmost and rightmost 2 bins), as it should be done during likelihood
## calculation. Note how the middle bins match (3), though.

nx.4096 <- 4096
nkl.4096 <- pars.fft.just.x.1024$hi$padding[1] # 256
nkr.4096 <- pars.fft.just.x.1024$hi$padding[2] # 256
dx <- 0.0005

## initialization
vars.fft.just.x.4096 <- matrix(0, control.fft.just.x.1024$nx * control.fft.just.x.1024$r, 2) # this matrix will have r times more rows than vars.fft.just.x.4096 (r = 4)

## populating states in all bins
vars.fft.just.x.4096[seq_len(ext.fft.just.x.1024$ndat[1]),2] <- dnorm(ext.fft.just.x.1024$x[[1]], 0.0, sd) # we are using ndat[1] instead of ndat[2], as above in testPropagateChOneCh1024QuaSSETest
vars.4096 <- vars.fft.just.x.4096[seq_len(ext.fft.just.x.1024$ndat[1]),]

paste(vars.4096[1:48,2], collapse=", ")
## initialValues = 0.000353647683540531, 0.000357627448646487, 0.000361649739618714, 0.000365714984190948, 0.000369823614096463, 0.000373976065102163, 0.000378172777042955, 0.000382414193856355, 0.000386700763617376, 0.000391032938573662, 0.000395411175180895, 0.000399835934138456, 0.000404307680425366, 0.000408826883336479, 0.000413394016518956, 0.00041800955800901, 0.000422673990268911, 0.00042738780022428, 0.000432151479301657, 0.000436965523466329, 0.000441830433260469, 0.000446746713841521, 0.000451714875020898, 0.000456735431302938, 0.000461808901924177, 0.00046693581089287, 0.000472116687028841, 0.000477352064003592, 0.000482642480380733, 0.000487988479656683, 0.000493390610301674, 0.000498849425801072, 0.000504365484696964, 0.000509939350630071, 0.000515571592381964, 0.000521262783917567, 0.00052701350442799, 0.000532824338373647, 0.000538695875527712, 0.000544628711019852, 0.000550623445380317, 0.000556680684584297, 0.000562801040096648, 0.000568985128916886, 0.000575233573624552, 0.000581547002424852, 0.000587926049194663, 0.000594371353528846

## making kernel and FFTing
kern.4096 <- fftR.make.kern.debug(-dt * drift, sqrt(dt * diffusion), nx.4096, dx, nkl.4096, nkr.4096)
fy.4096 <- fft(kern.4096)

vars.4096.nkl.plus.nkr.zeros <- rbind(vars.4096, matrix(0, ncol=2, nrow=(nx.4096 - nrow(vars.4096)))) # must be matrix
res.4096 <- fftR.propagate.x.debug(vars.4096.nkl.plus.nkr.zeros, nx.4096, fy.4096, nkl.4096, nkr.4096)

## alternating elements with 0's to match SST's JavaFftService requirements
exp.ds.first48 <- rep(0, length(res.4096[1:48,2])*2)
idxs <- seq(1, length(res.4096[1:48,2])*2, by=2)
j <- 1
for (i in res.4096[1:48,2]) {
    exp.ds.first48[idxs[j]] = i
    j = j+1
}

print(paste(exp.ds.first48, collapse=", "))
## expectedDsFirst48 = 0.000353647683540531, 0, 0.000357627448646487, 0, 0.000361649739618714, 0, 0.000365714984190948, 0, 0.000369823614096463, 0, 0.000373976065102163, 0, 0.000378172777042955, 0, 0.000382414193856355, 0, 0.000386700763617376, 0, 0.000391032938573662, 0, 0.000395411175180895, 0, 0.000399835934138456, 0, 0.000404307680425366, 0, 0.000408826883336479, 0, 0.000413394016518956, 0, 0.00041800955800901, 0, 0.000422673990268911, 0, 0.00042738780022428, 0, 0.000432151479301657, 0, 0.000436965523466329, 0, 0.000441830433260469, 0, 0.000446746713841521, 0, 0.000451714875020898, 0, 0.000456735431302938, 0, 0.000461808901924177, 0, 0.00046693581089287, 0, 0.000472116687028841, 0, 0.000477352064003592, 0, 0.000482642480380733, 0, 0.000487988479656683, 0, 0.000493390610301674, 0, 0.000498849425801072, 0, 0.000504365484696964, 0, 0.000509939350630071, 0, 0.000515571592381964, 0, 0.000521262783917567, 0, 0.00052701350442799, 0, 0.000532824338373647, 0, 0.000538695875527712, 0, 0.000544628711019852, 0, 0.000550623445380317, 0, 0.000556680684584297, 0, 0.000562801040096648, 0, 0.000568985128916886, 0, 0.000575233573624552, 0, 0.000581547002424852, 0, 0.000587926049194663, 0, 0.000594371353528846, 0

## print(paste(res.4096[1:48,2], collapse=", "))
## (if using JTransforms) expectedDsFirst48 = 0.000353647683540531, 0.000357627448646487, 0.000361649739618714, 0.000365714984190948, 0.000369823614096463, 0.000373976065102163, 0.000378172777042955, 0.000382414193856355, 0.000386700763617376, 0.000391032938573662, 0.000395411175180895, 0.000399835934138456, 0.000404307680425366, 0.000408826883336479, 0.000413394016518956, 0.00041800955800901, 0.000422673990268911, 0.00042738780022428, 0.000432151479301657, 0.000436965523466329, 0.000441830433260469, 0.000446746713841521, 0.000451714875020898, 0.000456735431302938, 0.000461808901924177, 0.00046693581089287, 0.000472116687028841, 0.000477352064003592, 0.000482642480380733, 0.000487988479656683, 0.000493390610301674, 0.000498849425801072, 0.000504365484696964, 0.000509939350630071, 0.000515571592381964, 0.000521262783917567, 0.00052701350442799, 0.000532824338373647, 0.000538695875527712, 0.000544628711019852, 0.000550623445380317, 0.000556680684584297, 0.000562801040096648, 0.000568985128916886, 0.000575233573624552, 0.000581547002424852, 0.000587926049194663, 0.000594371353528846

exp.ds.mid48 <- rep(0, length(res.4096[1001:1048,2])*2)
idxs <- seq(1, length(res.4096[1001:1048,2])*2, by=2)
j <- 1
for (i in res.4096[1001:1048,2]) {
    exp.ds.mid48[idxs[j]] = i
    j = j+1
}

print(paste(exp.ds.mid48, collapse=", "))
## expectedDsLater48 = 1.12964601442883, 0, 1.13523957985681, 0, 1.14085371385815, 0, 1.14648844781881, 0, 1.1521438128928, 0, 1.15781984000018, 0, 1.16351655982519, 0, 1.16923400281429, 0, 1.17497219917421, 0, 1.18073117887008, 0, 1.18651097162341, 0, 1.19231160691021, 0, 1.19813311395904, 0, 1.20397552174904, 0, 1.20983885900802, 0, 1.21572315421049, 0, 1.22162843557575, 0, 1.22755473106588, 0, 1.23350206838385, 0, 1.23947047497152, 0, 1.24545997800775, 0, 1.25147060440637, 0, 1.25750238081428, 0, 1.26355533360948, 0, 1.26962948889911, 0, 1.27572487251749, 0, 1.28184151002416, 0, 1.28797942670193, 0, 1.29413864755491, 0, 1.30031919730656, 0, 1.30652110039772, 0, 1.31274438098464, 0, 1.31898906293703, 0, 1.32525516983611, 0, 1.33154272497262, 0, 1.33785175134486, 0, 1.34418227165675, 0, 1.35053430831583, 0, 1.35690788343134, 0, 1.36330301881221, 0, 1.36971973596514, 0, 1.37615805609261, 0, 1.38261800009092, 0, 1.38909958854822, 0, 1.39560284174258, 0, 1.40212777963999, 0, 1.40867442189243, 0, 1.41524278783588, 0

## print(paste(res.4096[1001:1048,2], collapse=", "))
## (if using JTransforms) expectedDsLater48 = 1.12964601442883, 1.13523957985681, 1.14085371385815, 1.14648844781881, 1.1521438128928, 1.15781984000018, 1.16351655982519, 1.16923400281429, 1.17497219917421, 1.18073117887008, 1.18651097162341, 1.19231160691021, 1.19813311395904, 1.20397552174904, 1.20983885900802, 1.21572315421049, 1.22162843557575, 1.22755473106588, 1.23350206838385, 1.23947047497152, 1.24545997800775, 1.25147060440637, 1.25750238081428, 1.26355533360948, 1.26962948889911, 1.27572487251749, 1.28184151002416, 1.28797942670193, 1.29413864755491, 1.30031919730656, 1.30652110039772, 1.31274438098464, 1.31898906293703, 1.32525516983611, 1.33154272497262, 1.33785175134486, 1.34418227165675, 1.35053430831583, 1.35690788343134, 1.36330301881221, 1.36971973596514, 1.37615805609261, 1.38261800009092, 1.38909958854822, 1.39560284174258, 1.40212777963999, 1.40867442189243, 1.41524278783588

